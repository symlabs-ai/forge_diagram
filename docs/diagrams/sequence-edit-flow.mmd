%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#0891b2', 'primaryTextColor': '#fff', 'primaryBorderColor': '#0e7490', 'lineColor': '#06b6d4'}}}%%
sequenceDiagram
    autonumber
    participant U as Usuario
    participant CE as CodeEditor
    participant UT as useTabs
    participant UH as useHistory
    participant US as useDiagramStorage
    participant LS as localStorage
    participant P as Preview
    participant M as Mermaid.js

    Note over U,M: Fluxo de Edicao de Diagrama

    U->>CE: Digita codigo
    CE->>CE: onChange()
    CE->>UT: updateTabCode(id, code)
    UT->>UH: setValue(code)
    UH->>UH: push to history stack

    Note over US,LS: Auto-save (a cada 5s)
    US->>LS: saveAutoSaveContent()

    UT->>P: code (via props)
    P->>M: mermaid.render()
    M-->>P: SVG
    P->>P: Display diagram

    Note over U,M: Undo/Redo

    U->>CE: Ctrl+Z
    CE->>UH: undo()
    UH->>UH: pop from past, push to future
    UH-->>CE: previous code
    CE->>UT: updateTabCode()
    UT->>P: code
    P->>M: re-render

    Note over U,M: Salvar Diagrama

    U->>U: Ctrl+S ou Save button
    U->>US: saveDiagram(name, code)
    US->>LS: store diagram
    LS-->>US: success
    US-->>U: Diagram saved
